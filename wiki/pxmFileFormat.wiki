= PXM file format description =

(This isn't about the real PlayStation protocol. See this page for that: [http://www.gamesx.com/controldata/psxcont/psxcont.htm SONY PLAYSTATIONÂ® CONTROLLER INFORMATION].)

== Header ==

{{{
000 4-byte signature: "PXM "
004 4-byte unsigned long: version number
008 4-byte unsigned long: version of the emulator used
00C 1-byte flags:
    bit 0: reserved, set to 0
    bit 1:
          if "0", movie begins from an embedded savestate
          if "1", movie begins from power-on
    bit 2:
          if "0", NTSC timing
          if "1", PAL timing
    other: reserved, set to 0
00D 1-byte flags: reserved, set to 0
00E 1-byte unsigned char: controller port 1 type
00F 1-byte unsigned char: controller port 2 type
010 4-byte unsigned long: number of frames
014 4-byte unsigned long: rerecord count
018 4-byte unsigned long: offset to the savestate inside file
01C 4-byte unsigned long: offset to the controller data inside file
020 4-byte unsigned long: string length
024 string: name of the author
}}}

== Savestate ==
After the header comes a compressed savestate. If the movie starts from power-on, the "savestate" is only 4 empty bytes.

== Controller Data ==
After the savestate, comes the controller data.

=== Controller Types ===
{{{
01 Mouse
02 Negcon
03 Konami Gun
04 Standard
05 Analog Joystick
06 Namco Guncon
07 Analog Controller
}}}

=== Bytes per Frame ===
{{{
04 Mouse
02 Standard
06 Analog Joystick
06 Analog Controller
}}}
^(The other controller types are currently not supported by PCSX.)^

So, if the movie uses 2 standard controllers, we know it will use 4 bytes per frame (2 bytes for player 1 and 2 bytes for player 2).

=== Frame Data ===
The corresponding bytes indicate which buttons are pressed at each frame for each controller.

*Standard Controller*
{{{
000 2-byte unsigned short:
    bit 0: Select
    bit 1: unknown
    bit 2: unknown
    bit 3: Start
    bit 4: Up
    bit 5: Right
    bit 6: Down
    bit 7: Left
    bit 8: L2
    bit 9: R2
    bit 10: L1
    bit 11: R1
    bit 12: Square
    bit 13: Triangle
    bit 14: Circle
    bit 15: X
}}}

*Analog Joystick/Controller*
{{{
000 2-byte unsigned short: same as standard
002 1-byte unsigned char: left X
003 1-byte unsigned char: left Y
004 1-byte unsigned char: right X
005 1-byte unsigned char: right Y
}}}
^(Values are in range 0-255, where 128 is center position.)^

*Mouse*
{{{
000 2-byte unsigned short: same as standard
002 1-byte unsigned char: X movement
003 1-byte unsigned char: Y movement
}}}
^(Values are in range 0-255, where 128 is center position.)^